<html>
<head>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="arbor.js"></script>
<script src="graphics.js"></script>
<script src="renderer.js"></script>
<script src="/socket.io/socket.io.js"></script>
</head>
<body>
<canvas id="viewport" width="800" height="600"></canvas>
<script>
function addConnection(peer1, peer2) {
  if (!sys.getNode(peer1)) {
    sys.addNode(peer1,{'color':'red','shape':'dot','label':peer1});
  }
  if (!sys.getNode(peer2)) {
    sys.addNode(peer2,{'color':'red','shape':'dot','label':peer2});
  }
  sys.addEdge(sys.getNode(peer1), sys.getNode(peer2));
}

function removeEdge(peer1, peer2) {
  sys.getEdges(peer1, peer2).prune(function() {
    return true;
  });
  sys.getEdges(peer2, peer1).prune(function() {
    return true;
  });
}

function recievedMessage(peer) {
  var node = sys.getNode(peer);
  if (node) {
    console.log(node);
    node.data.color = "blue";
    setTimeout(function() {
      node.data.color = "red";
      sys.renderer.redraw();
    }, 300);
  }
}

function sentMessage(peer) {
  var node = sys.getNode(peer);
  if (node) {
    console.log(node);
    node.data.color = "green";
    sys.renderer.redraw();
    setTimeout(function() {
      node.data.color = "red";
      sys.renderer.redraw();
    }, 300);
  }
}

var socket = io();
  socket.on('protest-data', function (data) {
    console.log(data);
    if (data.event == "connected") {
      console.log(data.event);
      addConnection(data.peer, data.connectedpeer);
    } else if (data.event == "disconnected") {
      removeEdge(data.peer, data.connectedpeer);
    } else if (data.event == "recieved-message") {
      sentMessage(data.peer);
    } else if (data.event == "sent-message") {
      recievedMessage(data.peer);
    }
  });

  var sys = arbor.ParticleSystem(1000, 400,1);
  sys.parameters({gravity:true});
  sys.renderer = Renderer("#viewport") ;
</script>
</body>
</html>